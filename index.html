<!doctype html>
<html>
  <head>
    <title>PC Live GPS Tracker with Trail</title>
    <meta charset="utf-8" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <style>
      body {
        margin: 0;
      }
      #map {
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
      const map = L.map("map").setView([0, 0], 15);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "Â© OpenStreetMap",
      }).addTo(map);

      let marker = L.marker([0, 0]).addTo(map);
      let path = [];
      let polyline = L.polyline(path, { weight: 4 }).addTo(map);

      let firstFix = true;

      if ("geolocation" in navigator) {
        navigator.geolocation.watchPosition(
          (position) => {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            const accuracy = position.coords.accuracy;

            // Ignore bad fixes
            if (accuracy > 100) return;

            // Remove jitter
            if (path.length > 0) {
              const last = path[path.length - 1];
              const distance = map.distance(last, [lat, lon]);
              if (distance < 10) return;
            }

            marker.setLatLng([lat, lon]);

            path.push([lat, lon]);
            polyline.setLatLngs(path);

            if (firstFix) {
              map.setView([lat, lon], 16);
              firstFix = false;
            }

            console.log(`ðŸ“ ${lat}, ${lon} (Â±${accuracy}m)`);
          },
          (error) => {
            alert("Location error: " + error.message);
          },
          {
            enableHighAccuracy: true,
            maximumAge: 0,
            timeout: 10000,
          },
        );
      } else {
        alert("Geolocation not supported");
      }
    </script>
  </body>
</html>
